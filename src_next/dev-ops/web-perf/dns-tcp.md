# DNS 与 TCP

![](./images/dns-tcp-1.jpg)

## DNS

全称 Domain Name System（域名系统），你给它一个域名，它给你返回一个 IP。

### DNS 访问流程

1. 当我们在浏览器输入一个域名，如 [baidu.com](http://baidu.com)。浏览器会先看自己有没有访问过 [baidu.com](http://baidu.com) 如果有，就把上一次的 IP 给你（缓存），如果没有，就去问操作系统。
2. 操作系统也会先看自己有没有缓存，如果没有，再去问 ISP（服务商），这里操作的系统地址的可以根据 hosts 手动更改。
3. 浏览器拿到 IP 后，就会建立 TCP 连接。

## TCP 连接

全称 Transmission Control Protocol（**传输控制协议**）。

### 三次握手

在下文的描述中 A 代指客户端，B 代指服务器

1. A 向 B 发送一个 同步 syn。
2. B 向 A 回复一个 ACK 知道，并发送一个同步 syn。
3. A 向 B 回复一个 ACK 知道。

> syn 是同步的缩写（不是同步异步的同步，是同步信息的同步）

> ACK 是 acknowledge（获悉）的缩写

<img class="w-100" src="./images/dns-tcp-2.png"/>

**为什么要有第三次连接？**

为了确定 A 可以回复（ACK），只有 A、B 都可以回复 TCP 连接才能建立成功

### 四次挥手

1. A 对 B 说 FIN(X) 表示我说完了。
2. B 对 A 回复 ACK(X) 知道了。
3. B 对 A 说 FIN(Y) 我说完了。
4. A 对 B 说 ACK(Y) 知道了。

> FIN（finish 结束）表示关闭连接

<img class="w-100" src="./images/dns-tcp-3.png"/>

当 A、S 将上面的信息都发送完后才会关闭

**为什么四次挥手中间两次不能合并？**

两次回复的中间可能还会发送其他数据

## TCP 和 UDP 的区别是什么？

TCP（传输控制协议）和UDP（用户数据报协议）是网络通信中常用的两种传输协议。它们的区别如下：

1. 连接方式：TCP是面向连接的协议，而UDP是无连接的协议。TCP在传输数据前需要先建立连接，而UDP直接发送数据。
2. 可靠性：TCP是可靠的传输协议，它保证数据的可靠传输，数据的丢失、重复、失序等问题都会被TCP协议处理。而UDP是不可靠的传输协议，数据传输过程中可能会有丢失、重复、失序等问题，但是UDP传输速度快，适合对数据可靠性要求不高的场景。
3. 数据传输：TCP将数据分割成小的数据包进行传输，并且保证数据包的顺序，接收端可以按照顺序将数据包组合成完整的数据。UDP则将数据作为单个数据包进行传输，不保证顺序和完整性。
4. 连接数：TCP支持一对一、一对多、多对一、多对多的连接，而UDP只支持一对一和一对多的连接。
5. 流量控制：TCP有流量控制机制，可以根据网络状况动态调整传输速率，避免网络拥塞。UDP没有流量控制机制，会一直以最大速度发送数据，容易导致网络拥塞。

总之，TCP适合对数据可靠性要求较高的场景，例如文件传输、电子邮件等；UDP适合对实时性要求较高、数据可靠性要求不高的场景，例如视频直播、语音通话等。

## TCP 面向连接有状态，UDP 无状态？

TCP是面向连接的协议，建立连接后会在通信双方之间建立一个虚拟的通道，通信过程中会保持一定的状态信息，如序列号、确认号等。这些状态信息被用来保证数据传输的可靠性和顺序性。因此，TCP是有状态的协议。

相反，UDP是无连接的协议，不需要建立连接，也不需要保持连接状态。每个UDP数据包都是独立的，可以独立地发送和接收。UDP不会保证数据的可靠传输和顺序传输，也不会维护连接状态信息，因此是无状态的协议。

这种有状态和无状态的区别直接影响了TCP和UDP在网络通信中的应用场景。TCP适用于对数据可靠性要求较高的场景，如文件传输、电子邮件等；而UDP适用于对实时性要求较高的场景，如视频直播、语音通话等。
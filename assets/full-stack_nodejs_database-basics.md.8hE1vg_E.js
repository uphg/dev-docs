import{_ as s}from"./chunks/plugin-vue_export-helper.x3n3nnut.js";import{x as i,v as a,z as n}from"./chunks/vue.6z6dcVl3.js";const t="/dev-docs/assets/database-first-normal-form-demo1.CWZ5qwzN.png",l="/dev-docs/assets/database-first-normal-form-demo2.9XusJA6S.png",h="/dev-docs/assets/database-first-normal-form-demo3.S1_x8C9X.jpg",k="/dev-docs/assets/database-second-paradigm.9sc-Iqow.png",p="data:image/png;base64,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",e="/dev-docs/assets/database-basics-inner-join.j1IspV6r.png",r="/dev-docs/assets/database-basics-left-join.JKNBT7Sn.png",d="/dev-docs/assets/database-basics-right-join.w86duE0O.png",E="/dev-docs/assets/database-basics-full-outer-join.zwQOmHET.png",g="/dev-docs/assets/database-basics-join-bases.6t1Yupwx.png",o="/dev-docs/assets/database-basics-left-join-excluding-inner-join.bRDU_l15.png",y="/dev-docs/assets/database-basics-right-join-excluding-inner-join.lgHA09Km.png",c="/dev-docs/assets/database-basics-full-outer-join-excluding-inner-join.JuMrzKMU.png",F="/dev-docs/assets/database-basics-join-all.Q6dl9MYY.png",v=JSON.parse('{"title":"数据库基础知识","description":"","frontmatter":{},"headers":[],"relativePath":"full-stack/nodejs/database-basics.md","filePath":"full-stack/nodejs/database-basics.md","lastUpdated":1690688515000}'),u={name:"full-stack/nodejs/database-basics.md"},A=n('<h1 id="数据库基础知识" tabindex="-1">数据库基础知识 <a class="header-anchor" href="#数据库基础知识" aria-label="Permalink to &quot;数据库基础知识&quot;">​</a></h1><p>总结数据库基础知识的笔记。</p><h2 id="范式-nf" tabindex="-1">范式（NF） <a class="header-anchor" href="#范式-nf" aria-label="Permalink to &quot;范式（NF）&quot;">​</a></h2><p>范式（NF）。表示一张数据表的表结构所符合的某种设计标准的级别，数据库范式分为 1NF，2NF，3NF，BCNF，4NF，5NF。一般在我们设计关系型数据库的时候，最多考虑到 BCNF 就够了。</p><h2 id="第一范式-1nf" tabindex="-1">第一范式（1NF） <a class="header-anchor" href="#第一范式-1nf" aria-label="Permalink to &quot;第一范式（1NF）&quot;">​</a></h2><p>首先是第一范式（1NF）。<strong>1NF 的定义为：符合 1NF 的关系中的每个属性都不可再分。表1</strong>所示的情况，就不符合 1NF 的要求。</p><p><img src="'+t+'" alt="表1"></p><p>实际上，<strong>1NF 是所有关系型数据库的最基本要求</strong>，你在关系型数据库管理系统（RDBMS），例如 SQL Server，Oracle，MySQL 中创建数据表的时候，如果数据表的设计不符合这个最基本的要求，那么操作一定是不能成功的。也就是说，只要在 RDBMS 中已经存在的数据表，一定是符合 1NF 的。如果我们要在 RDBMS 中表现表中的数据，就得设计为<strong>表2</strong>的形式：</p><p><img src="'+l+'" alt="表2"></p><p>但是仅仅符合 1NF 的设计，仍然会存在数据冗余过大，插入异常，删除异常，修改异常的问题，例如对于<strong>表3</strong>中的设计：</p><p><img src="'+h+'" alt="表2"></p><ol><li>每一名学生的学号、姓名、系名、系主任这些数据重复多次。每个系与对应的系主任的数据也重复多次——<strong>数据冗余过大</strong>。</li><li>假如学校新建了一个系，但是暂时还没有招收任何学生（比如3月份就新建了，但要等到8月份才招生），那么是无法将系名与系主任的数据单独地添加到数据表中去的——<strong>插入异常</strong></li><li>假如将某个系中所有学生相关的记录都删除，那么所有系与系主任的数据也就随之消失了（一个系所有学生都没有了，并不表示这个系就没有了）。——<strong>删除异常</strong></li><li>假如李小明转系到法律系，那么为了保证数据库中数据的一致性，需要修改三条记录中系与系主任的数据。——<strong>修改异常</strong>。</li></ol><p>正因为仅符合 1NF 的数据库设计存在着这样那样的问题，我们需要提高设计标准，去掉导致上述四种问题的因素，使其符合更高一级的范式（2NF），这就是所谓的“规范化”。</p><h2 id="第二范式-2nf" tabindex="-1">第二范式（2NF） <a class="header-anchor" href="#第二范式-2nf" aria-label="Permalink to &quot;第二范式（2NF）&quot;">​</a></h2><p><strong>定义</strong></p><ul><li>在 1NF 的基础上，添加了键。</li><li>通过键就可以确定一个唯一的值。比如上面的<strong>表3</strong>，通过学号就可以确定对应姓名，那么学号就是姓名的键。</li><li>有的时候键可以是多个，但是多个键不允许<strong>部分依赖</strong>。比如上面的<strong>表3</strong>，通过学号和课名，就可以唯一确定这个学生的分数，那么学号和课名就是这个分数的键。</li></ul><p><strong>依赖关系</strong></p><p>给出键，就能唯一确定字段的值，如给出学号，就能唯一确定姓名，反之则不行。</p><p>部分依赖：姓名依赖与学号，但是学号却不依赖与姓名，这种情况我们就叫做姓名部分依赖与学号。</p><p>使用第二范式改进<strong>表3</strong>：</p><p><img src="'+k+'" alt="第二范式示例表"></p><p><strong>第二范式的问题</strong></p><ul><li>假如想要修改经济系的系主任王强，需要改两处（存在间接依赖）。</li><li>假如删掉法律系的高芳芳，法律系就不存在了，因为法律系只有一个学生。</li><li>假如想要创建一个系，还是要必须添加一个学生。</li></ul><h2 id="第三范式-3nf" tabindex="-1">第三范式（3NF） <a class="header-anchor" href="#第三范式-3nf" aria-label="Permalink to &quot;第三范式（3NF）&quot;">​</a></h2><p><strong>定义</strong></p><p>一个表里不能有两层以上的依赖（间接依赖）。比如上面选课表：给出学号，就能确定系名，系名依赖于学号。给出系名，就能确定系主任，系主任依赖于系名。所以，系主任间接依赖于学号。</p><p>使用第三范式改进<strong>表4</strong>：</p><p><img src="'+p+`" alt="第三范式示例表"></p><p>现在我们来看一下，进行同样的操作，是否还存在着之前的那些问题？</p><ol><li>修改经济系的系主任王强：只需要修改一处。——有改进</li><li>删除某个系中所有的学生：该系的信息不会丢失。——有改进</li><li>添加一个系：在系表中添加即可。——有改进</li></ol><h2 id="bcnf-范式" tabindex="-1">BCNF 范式 <a class="header-anchor" href="#bcnf-范式" aria-label="Permalink to &quot;BCNF 范式&quot;">​</a></h2><p>要了解 BCNF 范式，那么先看这样一个问题：</p><p>若：</p><ol><li>某公司有若干个仓库。</li><li>每个仓库只能有一名管理员，一名管理员只能在一个仓库中工作。</li><li>一个仓库中可以存放多种物品，一种物品也可以存放在不同的仓库中。每种物品在每个仓库中都有对应的数量。</li></ol><p>那么关系模式 仓库（仓库名，管理员，物品名，数量） 属于哪一级范式？</p><p>答：已知函数依赖集：仓库名 → 管理员，管理员 → 仓库名，（仓库名，物品名）→ 数量<br> 键：（管理员，物品名），（仓库名，物品名）<br> 主属性：仓库名、管理员、物品名<br> 非主属性：数量<br> ∵ 不存在非主属性对键的部分依赖和间接。所以此关系模式属于 3NF。</p><p>基于此关系模式的关系（具体的数据）可能如图所示：</p><table><thead><tr><th>仓库名</th><th>管理员</th><th>物品名</th><th>数量</th></tr></thead><tbody><tr><td>上海仓</td><td>张三</td><td>iPhone 8s</td><td>25</td></tr><tr><td>上海仓</td><td>张三</td><td>iPad Air</td><td>35</td></tr><tr><td>北京仓</td><td>李四</td><td>iPhone 8s</td><td>50</td></tr><tr><td>北京仓</td><td>李四</td><td>iPad Mini</td><td>60</td></tr></tbody></table><p>好，既然此关系模式已经属于了 3NF，那么这个关系模式是否存在问题呢？我们来看以下几种操作：</p><ol><li>先新增加一个仓库，但尚未存放任何物品，是否可以为该仓库指派管理员？——不可以，因为物品名也是主属性，根据实体完整性的要求，主属性不能为空。</li><li>某仓库被清空后，需要删除所有与这个仓库相关的物品存放记录，会带来什么问题？——仓库本身与管理员的信息也被随之删除了。</li><li>如果某仓库更换了管理员，会带来什么问题？——这个仓库有几条物品存放记录，就要修改多少次管理员信息。</li></ol><p>从这里我们可以得出结论，在某些特殊情况下，即使关系模式符合 3NF 的要求，仍然存在着插入异常，修改异常与删除异常的问题，仍然不是“好”的设计。</p><p>造成此问题的原因：存在着<strong>主属性</strong>对于键的部分依赖与间接依赖。（在此例中就是存在主属性【仓库名】对于键【（管理员，物品名）】的部分依赖。</p><p>解决办法就是要在 3NF 的基础上消除<strong>主属性</strong>对于键的部分与间接依赖。</p><p>仓库（仓库名，管理员）</p><table><thead><tr><th>仓库名</th><th>管理员</th></tr></thead><tbody><tr><td>上海仓</td><td>张三</td></tr><tr><td>北京仓</td><td>李四</td></tr></tbody></table><p>库存（仓库名，物品名，数量）</p><table><thead><tr><th>仓库名</th><th>物品名</th><th>数量</th></tr></thead><tbody><tr><td>上海仓</td><td>iPhone 8s</td><td>25</td></tr><tr><td>上海仓</td><td>iPad Air</td><td>35</td></tr><tr><td>北京仓</td><td>iPhone 8s</td><td>50</td></tr><tr><td>北京仓</td><td>iPad Mini</td><td>60</td></tr></tbody></table><p>这样，之前的插入异常，修改异常与删除异常的问题就被解决了。</p><p>以上就是关于 BCNF 的解释。</p><h2 id="范式总结" tabindex="-1">范式总结 <a class="header-anchor" href="#范式总结" aria-label="Permalink to &quot;范式总结&quot;">​</a></h2><ul><li>第一范式：属性不可分割（不可具有多重含义）。</li><li>第二范式：在 1NF 的基础上，字段要完全依赖于键。</li><li>第三范式：在 2NF 的基础上，字段间没有间接依赖。</li><li>BCNF范式：在 3NF 的基础上，键中的属性也不存在间接依赖。</li></ul><h2 id="数据库设计经验" tabindex="-1">数据库设计经验 <a class="header-anchor" href="#数据库设计经验" aria-label="Permalink to &quot;数据库设计经验&quot;">​</a></h2><h3 id="高内聚" tabindex="-1">高内聚 <a class="header-anchor" href="#高内聚" aria-label="Permalink to &quot;高内聚&quot;">​</a></h3><ul><li>把相关的字段放到一起，不相关的字段分开建表。</li><li>如果两个字段能够单独建表，那就单独建表。</li></ul><h3 id="低耦合" tabindex="-1">低耦合 <a class="header-anchor" href="#低耦合" aria-label="Permalink to &quot;低耦合&quot;">​</a></h3><ul><li>如果两个表之间有弱关系，可以新建一个中间表（关联表）</li><li>一对一可以放在一个表，也可以两个表加外键。</li><li>一对多一般使用外键。</li><li>多对多一般建立中间表。</li></ul><h3 id="一对一" tabindex="-1">一对一 <a class="header-anchor" href="#一对一" aria-label="Permalink to &quot;一对一&quot;">​</a></h3><p>假设需要做一个学生管理系统，一个学生只能加入一个班级。</p><p><strong>可以把班级放在学生表里</strong></p><ul><li>（学生表）学生id：1001，姓名：小明，班级id：4002</li><li>（班级表）班级id：4002，名称：入门1班</li></ul><p><strong>也可以单独建立关联表</strong></p><ul><li>（学生表）学生id：1001，姓名：小名</li><li>（学生班级表）学生id：1001，id：2003，班级id：4002</li><li>（班级表）班级id：4004，名称：入门1班</li></ul><h3 id="一对多" tabindex="-1">一对多 <a class="header-anchor" href="#一对多" aria-label="Permalink to &quot;一对多&quot;">​</a></h3><p>假设需要做一个出版社的图书管理系统，一个作者出版了多本图书。<strong>可以把书和作者放在一个表里吗？</strong></p><p>某些 DBMS 支持数组，可以存两个 id 到一个字段内</p><ul><li>（作者表）作者id：10001，姓名：阿强，books：[2001, 3002]</li></ul><blockquote><p>但是如果 DBMS 不支持数组，就不能这样做了</p></blockquote><p><strong>单独建立关系表（推荐）</strong></p><p>为了解决上面的问题，我们可以单独建立一个关系表。</p><ul><li>（作者表）作者id：1001，姓名：阿强</li><li>（出版表）id：2001，作者id：1001，书id：4002，出版社id：6003</li><li>（图书表）书id：4002，名称：JavaScript 入门</li></ul><h2 id="join" tabindex="-1">JOIN <a class="header-anchor" href="#join" aria-label="Permalink to &quot;JOIN&quot;">​</a></h2><p>用来把两个表合并起来，查询一些东西（部分内容参考自 <a href="https://zhuanlan.zhihu.com/p/29234064" target="_blank" rel="noreferrer">图解 SQL 里的各种 JOIN</a>）</p><h3 id="基本语法" tabindex="-1">基本语法 <a class="header-anchor" href="#基本语法" aria-label="Permalink to &quot;基本语法&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {[inner]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{left|right|full} [outer]} join table2 on boolean_expression</span></span></code></pre></div><p>使用示例</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uname, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">orders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">amount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">inner join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> on</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> orders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>上面的示例做了以下事情</p><ol><li>查询 users 表中的 name 字段，别名为 uname，查询 orders 表中的 amount 字段，别名为 amount</li><li>关联 users 表与 orders 表</li><li>关联条件为 users.id=orders.user_id;</li></ol><h3 id="inner-join" tabindex="-1">inner join <a class="header-anchor" href="#inner-join" aria-label="Permalink to &quot;inner join&quot;">​</a></h3><p>inner join 一般被译作内连接。内连接查询能将左表（表 A）和右表（表 B）中能关联起来的数据连接后返回。</p><p><img src="`+e+'" alt="inner join 图示"></p><h3 id="left-join" tabindex="-1">left join <a class="header-anchor" href="#left-join" aria-label="Permalink to &quot;left join&quot;">​</a></h3><p>left join 一般被译作左连接，也写作 left outer join。左连接查询会返回左表（表 A）中所有记录，不管右表（表 B）中有没有关联的数据。在右表中找到的关联数据列也会被一起返回。</p><p><img src="'+r+'" alt="left join 图示"></p><h3 id="right-join" tabindex="-1">right join <a class="header-anchor" href="#right-join" aria-label="Permalink to &quot;right join&quot;">​</a></h3><p>right join 一般被译作右连接，也写作 right outer join。右连接查询会返回右表（表 B）中所有记录，不管左表（表 A）中有没有关联的数据。在左表中找到的关联数据列也会被一起返回。</p><p><img src="'+d+'" alt="right join 图示"></p><h3 id="full-outer-join" tabindex="-1">full outer join <a class="header-anchor" href="#full-outer-join" aria-label="Permalink to &quot;full outer join&quot;">​</a></h3><p>full outer join 一般被译作外连接、全连接，实际查询语句中可以写作 full outer join 或 full join。外连接查询能返回左右表里的所有记录，其中左右表里能关联起来的记录被连接后返回。</p><p><img src="'+E+'" alt="full outer join 图示"></p><p>以上四种，就是 SQL 里常见 join 的种类和概念了，看一下它们的合影：</p><p><img src="'+g+'" alt="四种基本 join 图示"></p><p>下面是 join 的延伸用法</p><h3 id="left-join-excluding-inner-join" tabindex="-1">left join excluding inner join <a class="header-anchor" href="#left-join-excluding-inner-join" aria-label="Permalink to &quot;left join excluding inner join&quot;">​</a></h3><p>返回左表有但右表没有关联数据的记录集。</p><p><img src="'+o+'" alt="left join excluding inner join 图示"></p><h3 id="right-join-excluding-inner-join" tabindex="-1">right join excluding inner join <a class="header-anchor" href="#right-join-excluding-inner-join" aria-label="Permalink to &quot;right join excluding inner join&quot;">​</a></h3><p>返回右表有但左表没有关联数据的记录集。</p><p><img src="'+y+'" alt="right join excluding inner join 图示"></p><h3 id="full-outer-join-excluding-inner-join" tabindex="-1">full outer join excluding inner join <a class="header-anchor" href="#full-outer-join-excluding-inner-join" aria-label="Permalink to &quot;full outer join excluding inner join&quot;">​</a></h3><p>返回左表和右表里没有相互关联的记录集。</p><p><img src="'+c+'" alt="full outer join excluding inner join 图示"></p><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>以上七种用法基本上可以覆盖各种 join 查询了。全家福</p><p><img src="'+F+`" alt="七种常用 join 图示"></p><h3 id="使用-inner-join-关联两个表" tabindex="-1">使用 inner join 关联两个表 <a class="header-anchor" href="#使用-inner-join-关联两个表" aria-label="Permalink to &quot;使用 inner join 关联两个表&quot;">​</a></h3><p>首先创建一个数据库</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 创建数据库 db1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">character</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8mb4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">collate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8mb4_unicode_ci;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 查看所有数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show databases;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 使用 db1 数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db1;</span></span></code></pre></div><p>然后创建几个表，其中员工表用来记录商店的收银员，订单表用来记录用户消费的订单。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 创建 用户表，有 id（自增长序列）和 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（字符串）两个属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">serial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 创建 员工表，有 id（自增长序列）和 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">（字符串）两个属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> staffs (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">serial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 创建 订单表，用来记录用户消费的订单，它有：id、user_id、staff_id、amount 这几个属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">serial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unsigned, staff_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unsigned, amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unsigned);</span></span></code></pre></div><p>在表中创建几条记录</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;XiaoMing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Jack&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> staffs (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;XiaoHong&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> staffs (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ZhangSan&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders (user_id, staff_id, amount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); # 记录一笔 XiaoMing 消费的 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 元订单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders (user_id, staff_id, amount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); # 记录一笔 Jack 消费的 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 元订单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders (user_id, staff_id, amount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">320</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); # 记录一笔 Jack 消费的 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">320</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 元订单</span></span></code></pre></div><p>查看已创建表的数据</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users;</span></span></code></pre></div><p>使用 inner join 关联用户表（users）和订单表（orders），来展示更清晰的消费订单记录。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uname, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">orders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">amount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> amount</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     &gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">inner join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     &gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> on</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> orders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----------+--------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| uname    | amount |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----------+--------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| XiaoMing |    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| Jack     |    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| Jack     |    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">320</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----------+--------+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span></code></pre></div><h2 id="缓存字段" tabindex="-1">缓存字段 <a class="header-anchor" href="#缓存字段" aria-label="Permalink to &quot;缓存字段&quot;">​</a></h2><ul><li>假如要获取一个博客的评论数</li><li>如果每次获取都通过查询所有评论来获取会很慢</li><li>我们可以添加一个缓存字段，比如 <code>comment_count</code></li><li>每次添加博客 +1，每次删除博客 -1</li><li>像这样的字段就叫缓存字段</li></ul><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><ul><li>一个用户评论以后，后台需要做两件事情</li><li>第一步，在 comments 表中新增记录</li><li>第二步，在 blogs 表中将对应的 comment——count 字段 +1</li><li>如果第一步执行后，第二步还没有执行怎么办（比如服务器断电等情况）</li><li>这样就会造成数据错误</li><li>这时就可以使用事务，事务主要用于处理连续的操作，只要有一次操作不成功，就不会执行后面的操作</li></ul><p>使用事务执行数据库操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">serial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> begin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  # 开始事务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ZhangSan&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LiSi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; # 提交事务</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| id | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | ZhangSan |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | LiSi     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span></code></pre></div><p>只要事务没有提交，就可以回滚</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> begin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;      # 开始事务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WangWu&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rollback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   # 回滚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users; # 因为回滚了，所以数据没有插入</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| id | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | ZhangSan |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">|  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | LiSi     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">----+----------+</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span></code></pre></div><h2 id="参考文章" tabindex="-1">参考文章 <a class="header-anchor" href="#参考文章" aria-label="Permalink to &quot;参考文章&quot;">​</a></h2><ul><li><a href="https://www.zhihu.com/question/24696366/answer/29189700" target="_blank" rel="noreferrer">如何理解关系型数据库的常见设计范式？</a><br></li><li><a href="https://zhuanlan.zhihu.com/p/29234064" target="_blank" rel="noreferrer">图解 SQL 里的各种 JOIN</a></li><li><a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noreferrer">MySQL 教程</a></li><li><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1" target="_blank" rel="noreferrer">数据库事务 - 维基百科</a></li><li><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95" target="_blank" rel="noreferrer">数据库索引 - 维基百科</a></li></ul>`,126),b=[A];function m(D,f,q,C,j,B){return a(),i("div",null,b)}const x=s(u,[["render",m]]);export{v as __pageData,x as default};
